<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨m Ng√†nh ƒê√∫ng - Ch·ªçn Tr∆∞·ªùng Chu·∫©n | T∆∞ V·∫•n H∆∞·ªõng Nghi·ªáp</title>
    <!-- T·ªëi ∆∞u SEO -->
    <meta name="description" content="Website t∆∞ v·∫•n ch·ªçn ng√†nh, ch·ªçn tr∆∞·ªùng ƒë·∫°i h·ªçc d·ª±a tr√™n s·ªü th√≠ch c√° nh√¢n, nƒÉng l·ª±c h·ªçc t·∫≠p v√† m·ª•c ti√™u t∆∞∆°ng lai. B·∫Øt ƒë·∫ßu b√†i test h∆∞·ªõng nghi·ªáp ngay!">
    <meta name="keywords" content="ch·ªçn ng√†nh, ch·ªçn tr∆∞·ªùng, h∆∞·ªõng nghi·ªáp, ƒë·∫°i h·ªçc, riasec, mbti">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Chart.js CDN (cho bi·ªÉu ƒë·ªì) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- Firebase SDK (Mandatory for Data Persistence) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, getDoc, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Khai b√°o bi·∫øn to√†n c·ª•c (Global Variables)
        window.firebaseApp = null;
        window.db = null;
        window.auth = null;
        window.currentUserId = null;
        window.isAuthReady = false;

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // H√†m kh·ªüi t·∫°o Firebase v√† x√°c th·ª±c
        async function initializeFirebase() {
            try {
                // T·∫Øt console logs cho Firebase (b·∫≠t l·∫°i n·∫øu c·∫ßn debug)
                // setLogLevel('Debug');
                
                if (Object.keys(firebaseConfig).length === 0) {
                     console.error("Firebase config is missing. Data persistence will not work.");
                     window.isAuthReady = true;
                     return;
                }

                window.firebaseApp = initializeApp(firebaseConfig);
                window.db = getFirestore(window.firebaseApp);
                window.auth = getAuth(window.firebaseApp);
                
                // 1. Theo d√µi tr·∫°ng th√°i x√°c th·ª±c
                onAuthStateChanged(window.auth, (user) => {
                    window.currentUserId = user ? user.uid : null;
                    window.isAuthReady = true;
                    console.log("Firebase Auth State Changed. User ID:", window.currentUserId);
                    // Sau khi Auth s·∫µn s√†ng, kh·ªüi t·∫°o logic ·ª©ng d·ª•ng ch√≠nh
                    if (window.currentUserId && window.mainAppInit) {
                        window.mainAppInit();
                    }
                });

                // 2. Th·ª±c hi·ªán ƒëƒÉng nh·∫≠p ban ƒë·∫ßu
                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                } else {
                    await signInAnonymously(window.auth);
                }
            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                window.isAuthReady = true;
            }
        }

        initializeFirebase();

        // Export c√°c h√†m c·∫ßn thi·∫øt cho logic ch√≠nh
        window.saveTestResult = async (resultData) => {
            if (!window.isAuthReady || !window.currentUserId) {
                console.error("Cannot save: Auth not ready or User ID missing.");
                return;
            }
            try {
                const docPath = `artifacts/${appId}/users/${window.currentUserId}/testResults/latest`;
                await setDoc(doc(window.db, docPath), {
                    ...resultData,
                    timestamp: new Date().toISOString(),
                    userId: window.currentUserId,
                    appId: appId
                }, { merge: true });
                console.log("Test results saved successfully to Firestore.");
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        };

        window.listenForTestResults = (callback) => {
            if (!window.isAuthReady || !window.currentUserId) {
                console.warn("Cannot start listener: Auth not ready or User ID missing.");
                return () => {}; // Tr·∫£ v·ªÅ h√†m h·ªßy r·ªóng
            }
            const docPath = `artifacts/${appId}/users/${window.currentUserId}/testResults/latest`;
            const unsub = onSnapshot(doc(window.db, docPath), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    callback(docSnapshot.data());
                } else {
                    callback(null);
                }
            }, (error) => {
                console.error("Error listening to test results:", error);
                callback(null);
            });

            return unsub; // Tr·∫£ v·ªÅ h√†m h·ªßy listener
        };

    </script>
    <style>
        :root {
            --color-primary: #2563eb;
            --color-light: #f1f5f9;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
        }
        /* Custom scrollbar for a touch of modernity */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-light); }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-primary); }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s ease-out forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="#home" class="text-2xl font-bold text-blue-600 hover:text-blue-700 transition duration-300">
                    <span class="text-gray-800">U-</span>Guide
                </a>
                <!-- Desktop Menu -->
                <nav class="hidden md:flex space-x-6 lg:space-x-8">
                    <a href="#home" class="nav-link text-gray-600 hover:text-blue-600 transition duration-300 font-medium">Trang ch·ªß</a>
                    <a href="#test" class="nav-link text-gray-600 hover:text-blue-600 transition duration-300 font-medium">B√†i test</a>
                    <a href="#majors" class="nav-link text-gray-600 hover:text-blue-600 transition duration-300 font-medium">Ng√†nh h·ªçc</a>
                    <a href="#universities" class="nav-link text-gray-600 hover:text-blue-600 transition duration-300 font-medium">Tr∆∞·ªùng h·ªçc</a>
                    <a href="#blog" class="nav-link text-gray-600 hover:text-blue-600 transition duration-300 font-medium">Blog</a>
                    <a href="#dashboard" class="nav-link text-blue-600 border border-blue-600 px-3 py-1 rounded-full hover:bg-blue-50 transition duration-300 font-medium">Dashboard</a>
                </nav>
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="md:hidden p-2 text-gray-600 rounded-lg hover:bg-gray-100 transition duration-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-gray-50 border-t">
                <a href="#home" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">Trang ch·ªß</a>
                <a href="#test" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">B√†i test</a>
                <a href="#majors" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">Ng√†nh h·ªçc</a>
                <a href="#universities" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">Tr∆∞·ªùng h·ªçc</a>
                <a href="#blog" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">Blog</a>
                <a href="#dashboard" class="block px-3 py-2 rounded-md text-base font-medium text-blue-600 hover:bg-blue-100">Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-container" class="min-h-screen bg-gray-50">
        <!-- Views will be injected here -->
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-12">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-blue-400">U-Guide</h3>
                    <p class="text-sm text-gray-400">T∆∞ v·∫•n h∆∞·ªõng nghi·ªáp d·ª±a tr√™n khoa h·ªçc d·ªØ li·ªáu v√† s·ªü th√≠ch c√° nh√¢n.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">ƒêi·ªÅu h∆∞·ªõng</h3>
                    <ul class="space-y-2">
                        <li><a href="#home" class="text-gray-400 hover:text-blue-300 text-sm transition">Trang ch·ªß</a></li>
                        <li><a href="#test" class="text-gray-400 hover:text-blue-300 text-sm transition">B√†i test</a></li>
                        <li><a href="#majors" class="text-gray-400 hover:text-blue-300 text-sm transition">Ng√†nh h·ªçc</a></li>
                        <li><a href="#universities" class="text-gray-400 hover:text-blue-300 text-sm transition">Tr∆∞·ªùng h·ªçc</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Th√¥ng tin</h3>
                    <ul class="space-y-2">
                        <li><a href="#blog" class="text-gray-400 hover:text-blue-300 text-sm transition">Blog H∆∞·ªõng nghi·ªáp</a></li>
                        <li><a href="#contact" class="text-gray-400 hover:text-blue-300 text-sm transition">Li√™n h·ªá</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-300 text-sm transition">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-300 text-sm transition">Ch√≠nh s√°ch Quy·ªÅn ri√™ng t∆∞</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Li√™n h·ªá</h3>
                    <p class="text-sm text-gray-400">Email: xunchung03092009@gmail.com</p>
                    <p class="text-sm text-gray-400">Hotline: 0355839894</p>
                    <p class="text-sm text-gray-400">VƒÉn ph√≤ng: Tr∆∞·ªùng THPT ThƒÉng Long</p>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 flex justify-between items-center">
                <p class="text-sm text-gray-500">&copy; 2024 U-Guide. All rights reserved.</p>
                <p id="footer-user-id" class="text-xs text-gray-500">User ID: ƒêang t·∫£i...</p>
            </div>
        </div>
    </footer>

    <script>
        // ====================================================================
        // MOCK DATA (D·ªØ li·ªáu m·∫´u - Ti·∫øng Vi·ªát)
        // ====================================================================

        const MOCK_QUESTIONS = [
            // RIASEC - 10 questions
            { id: 1, type: 'riasec', category: 'Th·ª±c t·∫ø (R)', question: 'T√¥i th√≠ch s·ª≠a ch·ªØa c√°c thi·∫øt b·ªã ƒëi·ªán t·ª≠ ho·∫∑c m√°y m√≥c.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 2, type: 'riasec', category: 'Nghi√™n c·ª©u (I)', question: 'T√¥i th√≠ch ƒë·ªçc s√°ch khoa h·ªçc ho·∫∑c tham gia c√°c th√≠ nghi·ªám.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 3, type: 'riasec', category: 'Ngh·ªá thu·∫≠t (A)', question: 'T√¥i th√≠ch v·∫Ω, vi·∫øt, ho·∫∑c ch∆°i m·ªôt lo·∫°i nh·∫°c c·ª•.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 4, type: 'riasec', category: 'X√£ h·ªôi (S)', question: 'T√¥i th√≠ch gi√∫p ƒë·ª° ng∆∞·ªùi kh√°c gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ c√° nh√¢n ho·∫∑c h·ªçc t·∫≠p.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 5, type: 'riasec', category: 'Kinh doanh (E)', question: 'T√¥i th√≠ch t·ªï ch·ª©c s·ª± ki·ªán ho·∫∑c thuy·∫øt ph·ª•c ng∆∞·ªùi kh√°c theo √Ω m√¨nh.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 6, type: 'riasec', category: 'Quy ∆∞·ªõc (C)', question: 'T√¥i th√≠ch s·∫Øp x·∫øp t√†i li·ªáu, nh·∫≠p d·ªØ li·ªáu ho·∫∑c l√†m vi·ªác v·ªõi con s·ªë chi ti·∫øt.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 7, type: 'riasec', category: 'Nghi√™n c·ª©u (I)', question: 'T√¥i th√≠ch ph√¢n t√≠ch d·ªØ li·ªáu v√† t√¨m ra c√°c quy lu·∫≠t ti·ªÅm ·∫©n.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 8, type: 'riasec', category: 'Th·ª±c t·∫ø (R)', question: 'T√¥i th√≠ch l√†m vi·ªác ngo√†i tr·ªùi ho·∫∑c s·ª≠ d·ª•ng c√°c c√¥ng c·ª• v·∫≠t l√Ω.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 9, type: 'riasec', category: 'Kinh doanh (E)', question: 'T√¥i th√≠ch tham gia c√°c ho·∫°t ƒë·ªông c·∫°nh tranh v√† c√≥ m·ª•c ti√™u r√µ r√†ng.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            { id: 10, type: 'riasec', category: 'Ngh·ªá thu·∫≠t (A)', question: 'T√¥i d·ªÖ d√†ng t∆∞·ªüng t∆∞·ª£ng ra c√°c √Ω t∆∞·ªüng m·ªõi l·∫° v√† ƒë·ªôc ƒë√°o.', scoreMap: { 1: 0, 2: 1, 3: 2, 4: 3 } },
            // NƒÉng l·ª±c & M·ª•c ti√™u - 15 questions
            { id: 11, type: 'competency', category: 'NƒÉng l·ª±c To√°n', question: 'M·ª©c ƒë·ªô t·ª± tin c·ªßa b·∫°n khi gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ to√°n h·ªçc ph·ª©c t·∫°p?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 12, type: 'competency', category: 'NƒÉng l·ª±c S√°ng t·∫°o', question: 'B·∫°n c√≥ th∆∞·ªùng xuy√™n ƒë∆∞·ª£c khen v·ªÅ kh·∫£ nƒÉng ƒë∆∞a ra √Ω t∆∞·ªüng m·ªõi kh√¥ng?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 13, type: 'competency', category: 'NƒÉng l·ª±c VƒÉn/Ng√¥n ng·ªØ', question: 'B·∫°n c√≥ k·ªπ nƒÉng vi·∫øt b√°o c√°o, b√†i lu·∫≠n m·∫°ch l·∫°c t·ªët kh√¥ng?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 14, type: 'competency', category: 'T√≠nh c√°ch (H∆∞·ªõng Ngo·∫°i)', question: 'B·∫°n th√≠ch l√†m vi·ªác nh√≥m hay l√†m vi·ªác ƒë·ªôc l·∫≠p?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } }, // M√¥ ph·ªèng Big 5/MBTI
            { id: 15, type: 'competency', category: 'T√≠nh c√°ch (T·∫≠n T√¢m)', question: 'M·ª©c ƒë·ªô t·ªï ch·ª©c v√† qu·∫£n l√Ω th·ªùi gian c·ªßa b·∫°n?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 16, type: 'competency', category: 'NƒÉng l·ª±c Tin h·ªçc', question: 'B·∫°n t·ª± tin s·ª≠ d·ª•ng c√°c c√¥ng c·ª• l·∫≠p tr√¨nh, thi·∫øt k·∫ø, ho·∫∑c ph√¢n t√≠ch d·ªØ li·ªáu c∆° b·∫£n?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 17, type: 'competency', category: 'M·ª•c ti√™u L∆∞∆°ng', question: 'M·ª•c ti√™u m·ª©c l∆∞∆°ng kh·ªüi ƒëi·ªÉm c·ªßa b·∫°n sau 5 nƒÉm ra tr∆∞·ªùng l√† bao nhi√™u? (1: D∆∞·ªõi 10tr, 5: Tr√™n 25tr)', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 18, type: 'competency', category: 'M·ª•c ti√™u ·ªîn ƒë·ªãnh', question: 'B·∫°n ∆∞u ti√™n m·ªôt c√¥ng vi·ªác ·ªïn ƒë·ªãnh, truy·ªÅn th·ªëng hay m·ªôt c√¥ng vi·ªác nƒÉng ƒë·ªông, nhi·ªÅu th·ª≠ th√°ch?', scoreMap: { 1: 5, 2: 4, 3: 3, 4: 2, 5: 1 } }, // 1: nƒÉng ƒë·ªông -> 5: ·ªïn ƒë·ªãnh
            { id: 19, type: 'competency', category: 'M√¥n H√≥a/Sinh', question: 'B·∫°n c√≥ h·ª©ng th√∫ v·ªõi ng√†nh Y D∆∞·ª£c, M√¥i tr∆∞·ªùng ho·∫∑c C√¥ng ngh·ªá Sinh h·ªçc?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 20, type: 'competency', category: 'M√¥n L·ªãch S·ª≠/ƒê·ªãa L√Ω', question: 'B·∫°n c√≥ h·ª©ng th√∫ v·ªõi c√°c v·∫•n ƒë·ªÅ ch√≠nh tr·ªã, x√£ h·ªôi, ho·∫∑c du l·ªãch?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 21, type: 'competency', category: 'M√¥n Ti·∫øng Anh', question: 'B·∫°n t·ª± tin giao ti·∫øp v√† l√†m vi·ªác b·∫±ng Ti·∫øng Anh?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 22, type: 'competency', category: 'T∆∞ duy Logic', question: 'B·∫°n c√≥ kh·∫£ nƒÉng gi·∫£i quy·∫øt c√°c c√¢u ƒë·ªë, tr√≤ ch∆°i tr√≠ tu·ªá kh√¥ng?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 23, type: 'competency', category: 'C√¥ng Ngh·ªá', question: 'B·∫°n th√≠ch t√¨m hi·ªÉu v·ªÅ robot, t·ª± ƒë·ªông h√≥a, ho·∫∑c c√°c quy tr√¨nh s·∫£n xu·∫•t?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 24, type: 'competency', category: 'GD Kinh T·∫ø Ph√°p Lu·∫≠t', question: 'B·∫°n quan t√¢m ƒë·∫øn c√°c quy t·∫Øc ph√°p l√Ω, qu·∫£n l√Ω t√†i ch√≠nh c√° nh√¢n/doanh nghi·ªáp?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
            { id: 25, type: 'competency', category: 'Th·ªÉ D·ª•c/An Ninh', question: 'B·∫°n c√≥ s·ª©c kh·ªèe t·ªët v√† th√≠ch c√°c ho·∫°t ƒë·ªông v·∫≠n ƒë·ªông, k·ª∑ lu·∫≠t?', scoreMap: { 1: 1, 2: 2, 3: 3, 4: 4, 5: 5 } },
        ];

        const MOCK_MAJORS = [
            {
                id: 'it', name: 'C√¥ng ngh·ªá Th√¥ng tin (IT)', riasec: 'I, R', strength: { 'NƒÉng l·ª±c To√°n': 5, 'NƒÉng l·ª±c Tin h·ªçc': 5, 'T∆∞ duy Logic': 4, 'M·ª•c ti√™u L∆∞∆°ng': 5 },
                desc: 'Ph√°t tri·ªÉn, b·∫£o tr√¨ v√† qu·∫£n l√Ω h·ªá th·ªëng m√°y t√≠nh, ph·∫ßn m·ªÅm, m·∫°ng l∆∞·ªõi v√† c∆° s·ªü d·ªØ li·ªáu. L√† ng√†nh m≈©i nh·ªçn c·ªßa c√°ch m·∫°ng c√¥ng nghi·ªáp 4.0.',
                jobs: 'K·ªπ s∆∞ ph·∫ßn m·ªÅm, K·ªπ s∆∞ AI/Machine Learning, L·∫≠p tr√¨nh vi√™n di ƒë·ªông, Qu·∫£n tr·ªã m·∫°ng.',
                salary: '12 - 35 tri·ªáu VND/th√°ng',
                topUnis: ['B√°ch Khoa (HCM/HN)', 'ƒêH C√¥ng ngh·ªá (VNU)', 'FPT'], group: 'T·ª± nhi√™n'
            },
            {
                id: 'mkt', name: 'Marketing', riasec: 'E, A', strength: { 'NƒÉng l·ª±c S√°ng t·∫°o': 5, 'NƒÉng l·ª±c VƒÉn/Ng√¥n ng·ªØ': 4, 'T√≠nh c√°ch (H∆∞·ªõng Ngo·∫°i)': 4, 'M·ª•c ti√™u L∆∞∆°ng': 4 },
                desc: 'Nghi√™n c·ª©u th·ªã tr∆∞·ªùng, ph√°t tri·ªÉn chi·∫øn l∆∞·ª£c qu·∫£ng b√° s·∫£n ph·∫©m/d·ªãch v·ª•, x√¢y d·ª±ng th∆∞∆°ng hi·ªáu v√† qu·∫£n l√Ω quan h·ªá kh√°ch h√†ng.',
                jobs: 'Chuy√™n vi√™n Digital Marketing, Brand Manager, Ph√¢n t√≠ch th·ªã tr∆∞·ªùng, PR.',
                salary: '8 - 25 tri·ªáu VND/th√°ng',
                topUnis: ['Ngo·∫°i Th∆∞∆°ng', 'Kinh t·∫ø Qu·ªëc d√¢n', 'UEH'], group: 'Kinh t·∫ø/X√£ h·ªôi'
            },
            {
                id: 'yduoc', name: 'Y ƒêa khoa', riasec: 'S, I', strength: { 'M√¥n H√≥a/Sinh': 5, 'T∆∞ duy Logic': 4, 'T√≠nh c√°ch (T·∫≠n T√¢m)': 5, 'M·ª•c ti√™u ·ªîn ƒë·ªãnh': 5 },
                desc: 'Ch·∫©n ƒëo√°n, ƒëi·ªÅu tr·ªã, v√† ph√≤ng ng·ª´a b·ªánh t·∫≠t ·ªü ng∆∞·ªùi. C·∫ßn s·ª± t·ªâ m·ªâ, ki√™n tr√¨ v√† ki·∫øn th·ª©c sinh h·ªçc, h√≥a h·ªçc v·ªØng ch·∫Øc.',
                jobs: 'B√°c sƒ© chuy√™n khoa, B√°c sƒ© ph·∫´u thu·∫≠t, Gi·∫£ng vi√™n Y h·ªçc.',
                salary: '15 - 50 tri·ªáu VND/th√°ng',
                topUnis: ['ƒêH Y H√† N·ªôi', 'ƒêH Y D∆∞·ª£c TP.HCM', 'Ph·∫°m Ng·ªçc Th·∫°ch'], group: 'T·ª± nhi√™n'
            },
            {
                id: 'lhqt', name: 'Lu·∫≠t h·ªçc Qu·ªëc t·∫ø', riasec: 'S, C', strength: { 'NƒÉng l·ª±c VƒÉn/Ng√¥n ng·ªØ': 5, 'M√¥n Ti·∫øng Anh': 5, 'GD Kinh T·∫ø Ph√°p Lu·∫≠t': 4, 'M·ª•c ti√™u ·ªîn ƒë·ªãnh': 4 },
                desc: 'Nghi√™n c·ª©u v√† √°p d·ª•ng c√°c quy t·∫Øc, ƒëi·ªÅu ∆∞·ªõc qu·ªëc t·∫ø, gi·∫£i quy·∫øt tranh ch·∫•p ph√°p l√Ω gi·ªØa c√°c qu·ªëc gia, t·ªï ch·ª©c qu·ªëc t·∫ø.',
                jobs: 'Lu·∫≠t s∆∞ qu·ªëc t·∫ø, Chuy√™n vi√™n ph√°p ch·∫ø, Ngo·∫°i giao.',
                salary: '10 - 30 tri·ªáu VND/th√°ng',
                topUnis: ['ƒêH Lu·∫≠t H√† N·ªôi', 'ƒêH Lu·∫≠t TP.HCM', 'H·ªçc vi·ªán Ngo·∫°i giao'], group: 'X√£ h·ªôi'
            },
            {
                id: 'nn', name: 'Ng√¥n ng·ªØ Anh', riasec: 'A, S', strength: { 'M√¥n Ti·∫øng Anh': 5, 'NƒÉng l·ª±c VƒÉn/Ng√¥n ng·ªØ': 4, 'T√≠nh c√°ch (H∆∞·ªõng Ngo·∫°i)': 3, 'M·ª•c ti√™u L∆∞∆°ng': 3 },
                desc: 'Nghi√™n c·ª©u chuy√™n s√¢u v·ªÅ ng√¥n ng·ªØ, vƒÉn h√≥a, v√† vƒÉn h·ªçc Anh. Ph√°t tri·ªÉn k·ªπ nƒÉng d·ªãch thu·∫≠t v√† giao ti·∫øp ƒëa vƒÉn h√≥a.',
                jobs: 'Bi√™n/Phi√™n d·ªãch vi√™n, Gi√°o vi√™n Ti·∫øng Anh, Chuy√™n vi√™n Du l·ªãch/Kh√°ch s·∫°n.',
                salary: '7 - 20 tri·ªáu VND/th√°ng',
                topUnis: ['ƒêH Ngo·∫°i Ng·ªØ (VNU)', 'ƒêH S∆∞ Ph·∫°m TP.HCM', 'ƒêH H√† N·ªôi'], group: 'X√£ h·ªôi'
            },
        ];

        const MOCK_UNIVERSITIES = [
            {
                id: 'bk_hn', name: 'ƒê·∫°i h·ªçc B√°ch Khoa H√† N·ªôi (HUST)', region: 'B·∫Øc',
                image: 'https://placehold.co/400x200/2563eb/ffffff?text=HUST',
                location: 'H√† N·ªôi', tuition: '25-30 tri·ªáu/nƒÉm',
                majors: ['CNTT', 'C∆° Kh√≠', 'ƒêi·ªán T·ª≠'],
                score: { 2023: 27.5, 2022: 27.0, 2021: 26.5 }
            },
            {
                id: 'ftu_hn', name: 'ƒê·∫°i h·ªçc Ngo·∫°i Th∆∞∆°ng (FTU)', region: 'B·∫Øc',
                image: 'https://placehold.co/400x200/2563eb/ffffff?text=FTU',
                location: 'H√† N·ªôi', tuition: '20-25 tri·ªáu/nƒÉm',
                majors: ['Marketing', 'Kinh T·∫ø Qu·ªëc T·∫ø', 'T√†i Ch√≠nh'],
                score: { 2023: 28.0, 2022: 27.8, 2021: 27.5 }
            },
            {
                id: 'ueh_hcm', name: 'ƒê·∫°i h·ªçc Kinh t·∫ø TP.HCM (UEH)', region: 'Nam',
                image: 'https://placehold.co/400x200/2563eb/ffffff?text=UEH',
                location: 'TP.HCM', tuition: '20-25 tri·ªáu/nƒÉm',
                majors: ['Marketing', 'Kinh Doanh Qu·ªëc T·∫ø', 'K·∫ø To√°n'],
                score: { 2023: 26.5, 2022: 26.0, 2021: 25.5 }
            },
            {
                id: 'yds_hcm', name: 'ƒê·∫°i h·ªçc Y D∆∞·ª£c TP.HCM', region: 'Nam',
                image: 'https://placehold.co/400x200/2563eb/ffffff?text=YDS',
                location: 'TP.HCM', tuition: '15-20 tri·ªáu/nƒÉm',
                majors: ['Y ƒêa Khoa', 'RƒÉng H√†m M·∫∑t', 'D∆∞·ª£c H·ªçc'],
                score: { 2023: 28.5, 2022: 28.0, 2021: 27.5 }
            },
            {
                id: 'dhluat_hn', name: 'ƒê·∫°i h·ªçc Lu·∫≠t H√† N·ªôi', region: 'B·∫Øc',
                image: 'https://placehold.co/400x200/2563eb/ffffff?text=Law',
                location: 'H√† N·ªôi', tuition: '18-22 tri·ªáu/nƒÉm',
                majors: ['Lu·∫≠t Kinh T·∫ø', 'Lu·∫≠t Qu·ªëc T·∫ø', 'Lu·∫≠t H√†nh Ch√≠nh'],
                score: { 2023: 25.5, 2022: 25.0, 2021: 24.5 }
            }
        ];

        // ====================================================================
        // STATE MANAGEMENT & ROUTING
        // ====================================================================

        const appContainer = document.getElementById('app-container');
        let currentAnswers = {};
        let testResult = null;
        let chartInstances = {};

        // Mapping RIASEC categories to their initials
        const RIASEC_MAP = {
            'Th·ª±c t·∫ø (R)': 'R',
            'Nghi√™n c·ª©u (I)': 'I',
            'Ngh·ªá thu·∫≠t (A)': 'A',
            'X√£ h·ªôi (S)': 'S',
            'Kinh doanh (E)': 'E',
            'Quy ∆∞·ªõc (C)': 'C',
        };

        // Routing function
        function navigate(hash) {
            window.location.hash = hash;
            renderView(hash.replace('#', ''));
        }

        // Main rendering function based on hash
        function renderView(view) {
            appContainer.innerHTML = '';
            // Clear all chart instances before re-rendering
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};

            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Set animation delay for the current view container
            appContainer.className = 'min-h-screen bg-gray-50 fade-in';
            appContainer.style.animationDelay = '0s';

            switch (view.split('/')[0]) {
                case 'home':
                    renderHome();
                    break;
                case 'test':
                    renderTest();
                    break;
                case 'result':
                    renderResultDashboard();
                    break;
                case 'majors':
                    const majorId = view.split('/')[1];
                    majorId ? renderMajorDetail(majorId) : renderMajorList();
                    break;
                case 'universities':
                    const uniId = view.split('/')[1];
                    uniId ? renderUniversityDetail(uniId) : renderUniversityList();
                    break;
                case 'blog':
                    renderBlog();
                    break;
                case 'contact':
                    renderContact();
                    break;
                case 'dashboard':
                    renderUserDashboard();
                    break;
                default:
                    renderHome();
            }
        }

        // ====================================================================
        // CORE LOGIC - SCORING AND MATCHING
        // ====================================================================

        function calculateResults() {
            let riasecScores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
            let competencyScores = {};
            let totalCompScore = 0;

            MOCK_QUESTIONS.forEach(q => {
                const answerValue = currentAnswers[q.id];
                if (answerValue) {
                    const score = q.scoreMap[answerValue];
                    if (q.type === 'riasec') {
                        const riasecKey = RIASEC_MAP[q.category];
                        if (riasecKey) riasecScores[riasecKey] += score;
                    } else if (q.type === 'competency') {
                        competencyScores[q.category] = score;
                        totalCompScore += score;
                    }
                }
            });

            // Normalize RIASEC scores (0-100 scale for visual)
            const maxRiasec = 3 * 6; // Max 3 points per question * 6 questions (approx)
            const normalizedRiasec = {};
            Object.entries(riasecScores).forEach(([key, value]) => {
                normalizedRiasec[key] = Math.min(100, Math.round((value / maxRiasec) * 100));
            });

            // Get top 3 RIASEC types
            const sortedRiasec = Object.entries(normalizedRiasec)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 3)
                .map(([key]) => key);

            // Calculate Major Suitability
            const majorSuitability = MOCK_MAJORS.map(major => {
                let riasecMatch = 0;
                let strengthMatch = 0;

                // 1. RIASEC Match (50% weight)
                const requiredRiasec = major.riasec.split(', ');
                requiredRiasec.forEach(type => {
                    if (normalizedRiasec[type] >= 60) {
                        riasecMatch += 25; // 25 points per match, max 50
                    } else {
                        riasecMatch += normalizedRiasec[type] / 4; // Partial match
                    }
                });

                // 2. Competency Match (50% weight)
                const requiredStrengths = major.strength;
                let maxPossibleStrength = 0;
                let userStrengthScore = 0;

                Object.entries(requiredStrengths).forEach(([compName, requiredScore]) => {
                    maxPossibleStrength += 5 * requiredScore;
                    const userScore = competencyScores[compName] || 0;
                    userStrengthScore += (userScore * requiredScore); // Weighted score
                });
                
                // Strength score normalization (max strength match = 50)
                strengthMatch = Math.min(50, Math.round((userStrengthScore / maxPossibleStrength) * 50));
                
                let totalMatch = Math.round(riasecMatch + strengthMatch);

                let level = 'Low';
                if (totalMatch >= 80) level = 'Excellent';
                else if (totalMatch >= 65) level = 'Good';
                else if (totalMatch >= 50) level = 'Average';
                
                // Add top 3 universities based on location (very simplified)
                const topUnis = MOCK_UNIVERSITIES.filter(u => major.topUnis.includes(u.name))
                    .sort(() => 0.5 - Math.random()) // Random order for variety
                    .slice(0, 3);


                return {
                    id: major.id,
                    name: major.name,
                    match: totalMatch,
                    level: level,
                    topUnis: topUnis.map(u => ({ id: u.id, name: u.name, region: u.region }))
                };
            });

            // Sort and get top 5
            const topMajors = majorSuitability
                .sort((a, b) => b.match - a.match)
                .slice(0, 5);

            return {
                riasec: riasecScores,
                normalizedRiasec: normalizedRiasec,
                topRiasec: sortedRiasec.join(' - '),
                competency: competencyScores,
                topMajors: topMajors,
                timestamp: new Date().toISOString()
            };
        }

        // ====================================================================
        // VIEW RENDER FUNCTIONS
        // ====================================================================

        // --- 0. Helper Functions ---
        const getMatchColor = (level) => {
            switch (level) {
                case 'Excellent': return 'bg-green-100 text-green-700 border-green-400';
                case 'Good': return 'bg-blue-100 text-blue-700 border-blue-400';
                case 'Average': return 'bg-yellow-100 text-yellow-700 border-yellow-400';
                case 'Low': return 'bg-red-100 text-red-700 border-red-400';
                default: return 'bg-gray-100 text-gray-700 border-gray-400';
            }
        };

        const renderAlertModal = (title, message) => {
            const modalHtml = `
                <div id="custom-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[100]">
                    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all scale-100 fade-in">
                        <h3 class="text-xl font-bold text-blue-600 mb-4">${title}</h3>
                        <p class="text-gray-700 mb-6">${message}</p>
                        <button onclick="document.getElementById('custom-modal').remove()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">ƒê√≥ng</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        };


        // --- 1. Home View ---
        function renderHome() {
            appContainer.innerHTML = `
                <!-- Banner Section -->
                <section class="bg-blue-600 text-white pt-24 pb-32">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in">
                        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-4">
                            T√¨m ng√†nh ƒë√∫ng ‚Äì Ch·ªçn tr∆∞·ªùng chu·∫©n
                        </h1>
                        <p class="text-xl sm:text-2xl font-light opacity-90 mb-8">
                            T∆∞∆°ng lai s√°ng m·ªü!
                        </p>
                        <a href="#test" class="bg-white text-blue-600 font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-gray-100 transition duration-300 transform hover:scale-105">
                            <i class="fas fa-play mr-2"></i> L√†m b√†i test ngay
                        </a>
                    </div>
                </section>

                <!-- Gi·ªõi thi·ªáu & L·ª£i √≠ch -->
                <section class="py-16 bg-white">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-3xl font-bold text-center mb-12 text-gray-800 fade-in" style="animation-delay: 0.2s">V√¨ sao ch·ªçn U-Guide?</h2>
                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Benefit 1 -->
                            <div class="p-6 bg-gray-50 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:-translate-y-1 fade-in" style="animation-delay: 0.4s">
                                <div class="text-4xl text-blue-600 mb-4">üí°</div>
                                <h3 class="text-xl font-semibold mb-3">Hi·ªÉu r√µ b·∫£n th√¢n</h3>
                                <p class="text-gray-600">Ph√¢n t√≠ch chuy√™n s√¢u s·ªü th√≠ch (RIASEC) v√† t√≠nh c√°ch (MBTI/Big 5 c∆° b·∫£n) ƒë·ªÉ kh√°m ph√° nƒÉng l·ª±c c·ªët l√µi c·ªßa b·∫°n.</p>
                            </div>
                            <!-- Benefit 2 -->
                            <div class="p-6 bg-gray-50 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:-translate-y-1 fade-in" style="animation-delay: 0.6s">
                                <div class="text-4xl text-blue-600 mb-4">üéì</div>
                                <h3 class="text-xl font-semibold mb-3">G·ª£i √Ω ng√†nh h·ªçc ph√π h·ª£p</h3>
                                <p class="text-gray-600">ƒê·ªÅ xu·∫•t Top 5 ng√†nh h·ªçc c√≥ m·ª©c ƒë·ªô t∆∞∆°ng th√≠ch cao nh·∫•t v·ªõi ƒëi·ªÉm s·ªë v√† m·ª•c ti√™u t∆∞∆°ng lai c·ªßa b·∫°n.</p>
                            </div>
                            <!-- Benefit 3 -->
                            <div class="p-6 bg-gray-50 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:-translate-y-1 fade-in" style="animation-delay: 0.8s">
                                <div class="text-4xl text-blue-600 mb-4">üèõÔ∏è</div>
                                <h3 class="text-xl font-semibold mb-3">Ch·ªçn ƒë√∫ng tr∆∞·ªùng chu·∫©n</h3>
                                <p class="text-gray-600">Cung c·∫•p th√¥ng tin chi ti·∫øt v·ªÅ c√°c tr∆∞·ªùng ƒë√†o t·∫°o m·∫°nh, ƒëi·ªÉm chu·∫©n 3 nƒÉm v√† h·ªçc ph√≠ theo khu v·ª±c.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CTA Section -->
                <section class="py-16 bg-gray-100">
                    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in" style="animation-delay: 1s">
                        <h2 class="text-3xl font-bold mb-4 text-gray-800">S·∫µn s√†ng ƒë·ªãnh h√¨nh t∆∞∆°ng lai c·ªßa b·∫°n?</h2>
                        <p class="text-xl text-gray-600 mb-8">B√†i test ch·ªâ m·∫•t 10 ph√∫t v√† ho√†n to√†n mi·ªÖn ph√≠.</p>
                        <a href="#test" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-xl hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                            B·∫Øt ƒë·∫ßu B√†i test H∆∞·ªõng nghi·ªáp
                        </a>
                    </div>
                </section>
            `;
        }


        // --- 2. Test View ---
        function renderTest() {
            currentAnswers = {};
            let currentQuestionIndex = 0;
            const totalQuestions = MOCK_QUESTIONS.length;

            const updateProgress = () => {
                const percentage = Math.round((currentQuestionIndex / totalQuestions) * 100);
                const progressEl = document.getElementById('test-progress');
                if (progressEl) {
                    progressEl.style.width = `${percentage}%`;
                }
            };

            const renderQuestion = (index) => {
                const container = document.getElementById('question-container');
                if (!container) return;
                
                if (index >= totalQuestions) {
                    // Test completed
                    finishTest();
                    return;
                }

                const q = MOCK_QUESTIONS[index];
                const prevAnswer = currentAnswers[q.id] || null;

                const isRiasec = q.type === 'riasec';
                const options = isRiasec 
                    ? { 1: 'R·∫•t kh√¥ng th√≠ch', 2: 'Kh√¥ng th√≠ch', 3: 'Th√≠ch', 4: 'R·∫•t th√≠ch' }
                    : { 1: 'R·∫•t th·∫•p', 2: 'Th·∫•p', 3: 'Trung b√¨nh', 4: 'Cao', 5: 'R·∫•t cao' };
                
                const optionHtml = Object.entries(options).map(([value, label]) => `
                    <label class="block cursor-pointer p-4 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition duration-200">
                        <input type="radio" name="q_${q.id}" value="${value}" 
                               class="mr-3 text-blue-600 focus:ring-blue-500" 
                               ${prevAnswer == value ? 'checked' : ''}>
                        ${label}
                    </label>
                `).join('');

                container.innerHTML = `
                    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-100 transform translate-y-4 slide-up">
                        <p class="text-sm font-semibold text-blue-600 mb-2">${index + 1} / ${totalQuestions} - ${q.category}</p>
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">${q.question}</h3>
                        <div class="space-y-4">
                            ${optionHtml}
                        </div>
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button id="prev-btn" class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-full hover:bg-gray-300 transition duration-300 disabled:opacity-50" ${index === 0 ? 'disabled' : ''}>
                            <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i
                        </button>
                        <button id="next-btn" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-full hover:bg-blue-700 transition duration-300">
                            Ti·∫øp theo <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('next-btn').onclick = () => {
                    const selected = document.querySelector(`input[name="q_${q.id}"]:checked`);
                    if (selected) {
                        currentAnswers[q.id] = selected.value;
                        currentQuestionIndex++;
                        updateProgress();
                        renderQuestion(currentQuestionIndex);
                    } else {
                        renderAlertModal('C·∫£nh b√°o', 'Vui l√≤ng ch·ªçn m·ªôt ƒë√°p √°n ƒë·ªÉ ti·∫øp t·ª•c.');
                    }
                };
                document.getElementById('prev-btn').onclick = () => {
                    if (currentQuestionIndex > 0) {
                        currentQuestionIndex--;
                        updateProgress();
                        renderQuestion(currentQuestionIndex);
                    }
                };
            };

            const finishTest = async () => {
                testResult = calculateResults();
                await window.saveTestResult(testResult); // Save to Firestore
                navigate('result');
            };

            appContainer.innerHTML = `
                <section class="max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-4 fade-in">B√†i Test H∆∞·ªõng Nghi·ªáp</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">Ho√†n th√†nh 25 c√¢u h·ªèi ƒë·ªÉ kh√°m ph√° s·ªü th√≠ch, nƒÉng l·ª±c v√† ƒë·ªãnh h∆∞·ªõng ngh·ªÅ nghi·ªáp c·ªßa b·∫°n.</p>
                    
                    <!-- Progress Bar -->
                    <div class="mb-8 fade-in" style="animation-delay: 0.4s">
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="test-progress" class="bg-blue-600 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2 text-right">${totalQuestions} C√¢u h·ªèi</p>
                    </div>

                    <!-- Question Container -->
                    <div id="question-container" class="fade-in" style="animation-delay: 0.6s">
                        <!-- Question content injected here -->
                    </div>
                </section>
            `;

            updateProgress();
            renderQuestion(currentQuestionIndex);
        }

        // --- 3. Result Dashboard View ---
        function renderResultDashboard(result = null) {
            const finalResult = result || testResult;
            if (!finalResult) {
                appContainer.innerHTML = `
                    <section class="max-w-4xl mx-auto py-24 px-4 text-center">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Ch∆∞a c√≥ k·∫øt qu·∫£ test</h2>
                        <p class="text-gray-600 mb-8">Vui l√≤ng ho√†n th√†nh b√†i test ƒë·ªÉ xem k·∫øt qu·∫£ ph√¢n t√≠ch chuy√™n s√¢u c·ªßa b·∫°n.</p>
                        <a href="#test" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-700 transition">L√†m B√†i Test Ngay</a>
                    </section>
                `;
                return;
            }

            const { normalizedRiasec, topRiasec, topMajors, timestamp } = finalResult;

            appContainer.innerHTML = `
                <section class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-10">
                        <h2 class="text-4xl font-extrabold text-blue-600 mb-2 fade-in">K·∫øt Qu·∫£ Ph√¢n T√≠ch C√° Nh√¢n</h2>
                        <p class="text-lg text-gray-600 fade-in" style="animation-delay: 0.2s">ƒê∆∞·ª£c t·∫°o l√∫c: ${new Date(timestamp).toLocaleDateString('vi-VN')} ${new Date(timestamp).toLocaleTimeString('vi-VN')}</p>
                        <div class="mt-4 inline-flex items-center space-x-2 p-2 bg-blue-50 rounded-lg fade-in" style="animation-delay: 0.4s">
                            <span class="text-sm font-semibold text-blue-700">M√£ Ng∆∞·ªùi D√πng:</span>
                            <span class="text-sm text-blue-800 font-mono">${window.currentUserId || 'Ch∆∞a ƒëƒÉng nh·∫≠p'}</span>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-8 mb-12">
                        <!-- RIASEC Summary Card -->
                        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-200 fade-in" style="animation-delay: 0.6s">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Nh√≥m S·ªü Th√≠ch (RIASEC)</h3>
                            <div class="flex flex-col items-center">
                                <canvas id="riasec-radar-chart" class="max-h-72"></canvas>
                                <p class="text-lg font-semibold mt-4 text-blue-600">Top 3: ${topRiasec}</p>
                                <p class="text-sm text-gray-500 mt-1">ƒê√¢y l√† nh√≥m t√≠nh c√°ch ngh·ªÅ nghi·ªáp n·ªïi b·∫≠t c·ªßa b·∫°n.</p>
                            </div>
                        </div>

                        <!-- Competency Bar Chart -->
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200 fade-in" style="animation-delay: 0.8s">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">NƒÉng L·ª±c & M·ª•c Ti√™u</h3>
                            <canvas id="competency-bar-chart" class="max-h-96"></canvas>
                        </div>
                    </div>

                    <!-- Top 5 Major Suitability -->
                    <div class="bg-white p-8 rounded-xl shadow-2xl border border-blue-200 fade-in" style="animation-delay: 1s">
                        <h3 class="text-3xl font-bold text-center text-blue-600 mb-6">Top 5 Ng√†nh H·ªçc Ph√π H·ª£p Nh·∫•t</h3>
                        <div class="space-y-4">
                            ${topMajors.map((major, index) => {
                                const majorData = MOCK_MAJORS.find(m => m.id === major.id);
                                return `
                                    <div class="p-4 sm:p-6 border rounded-xl flex flex-col md:flex-row items-start md:items-center justify-between transition duration-300 hover:shadow-md">
                                        <div class="flex items-center mb-3 md:mb-0">
                                            <span class="text-3xl font-extrabold text-blue-600 mr-4 w-10">${index + 1}.</span>
                                            <div>
                                                <a href="#majors/${major.id}" class="text-xl font-semibold text-gray-800 hover:text-blue-600 transition">${major.name}</a>
                                                <p class="text-sm text-gray-500">Tr∆∞·ªùng ƒë·ªÅ xu·∫•t: ${major.topUnis.map(u => u.name).join(', ')}</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-4 w-full md:w-auto">
                                            <div class="text-center min-w-[120px]">
                                                <p class="text-2xl font-bold ${major.match >= 80 ? 'text-green-600' : major.match >= 65 ? 'text-blue-600' : 'text-yellow-600'}">${major.match}%</p>
                                                <span class="text-xs font-medium px-2 py-0.5 rounded-full ${getMatchColor(major.level)}">${major.level}</span>
                                            </div>
                                            <a href="#majors/${major.id}" class="bg-blue-50 text-blue-600 px-3 py-2 rounded-lg text-sm font-medium hover:bg-blue-100 transition">Xem chi ti·∫øt</a>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </section>
            `;

            // Render Charts
            // 1. RIASEC Radar Chart
            const riasecLabels = Object.keys(normalizedRiasec);
            const riasecData = Object.values(normalizedRiasec);
            const ctxRadar = document.getElementById('riasec-radar-chart');
            if (ctxRadar) {
                chartInstances.riasec = new Chart(ctxRadar, {
                    type: 'radar',
                    data: {
                        labels: riasecLabels.map(key => Object.keys(RIASEC_MAP).find(k => RIASEC_MAP[k] === key) || key),
                        datasets: [{
                            label: 'M·ª©c ƒë·ªô ph√π h·ª£p (%)',
                            data: riasecData,
                            backgroundColor: 'rgba(37, 99, 235, 0.2)',
                            borderColor: '#2563eb',
                            pointBackgroundColor: '#2563eb',
                            borderWidth: 2,
                            fill: true,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                                grid: { color: 'rgba(0, 0, 0, 0.1)' },
                                pointLabels: { font: { size: 12, family: 'Inter' } },
                                suggestedMin: 0,
                                suggestedMax: 100,
                                ticks: { stepSize: 25, display: false }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }

            // 2. Competency Bar Chart
            const competencyLabels = Object.keys(finalResult.competency);
            const competencyData = Object.values(finalResult.competency);
            const ctxBar = document.getElementById('competency-bar-chart');
            if (ctxBar) {
                chartInstances.competency = new Chart(ctxBar, {
                    type: 'bar',
                    data: {
                        labels: competencyLabels,
                        datasets: [{
                            label: 'ƒêi·ªÉm T·ª± ƒë√°nh gi√° (Thang 1-5)',
                            data: competencyData,
                            backgroundColor: '#2563eb',
                            borderColor: '#1d4ed8',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 5,
                                ticks: { stepSize: 1 }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }
        }
        
        // --- 4. Majors View ---
        function renderMajorList() {
            let filterGroup = 'all';
            let filterLevel = 'all';

            const majorListHtml = (majors) => {
                return majors.map(major => {
                    const matchData = testResult ? testResult.topMajors.find(m => m.id === major.id) : { match: 'N/A', level: 'N/A' };
                    const levelClass = matchData.match === 'N/A' ? 'bg-gray-100 text-gray-700' : getMatchColor(matchData.level);
                    
                    return `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:-translate-y-0.5 fade-in">
                            <h3 class="text-xl font-bold text-blue-600 mb-2">${major.name}</h3>
                            <p class="text-sm text-gray-500 mb-4">Nh√≥m RIASEC: ${major.riasec} | Nh√≥m ng√†nh: ${major.group}</p>
                            <p class="text-gray-700 line-clamp-3">${major.desc}</p>
                            
                            <div class="mt-4 flex justify-between items-center border-t pt-4">
                                <div>
                                    <p class="text-xs font-semibold text-gray-500">M·ª©c ph√π h·ª£p:</p>
                                    <span class="text-lg font-bold ${matchData.match >= 80 ? 'text-green-600' : matchData.match >= 65 ? 'text-blue-600' : 'text-yellow-600'}">${matchData.match}%</span>
                                    ${matchData.level !== 'N/A' ? `<span class="text-xs font-medium ml-2 px-2 py-0.5 rounded-full ${levelClass}">${matchData.level}</span>` : ''}
                                </div>
                                <a href="#majors/${major.id}" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition">Chi ti·∫øt</a>
                            </div>
                        </div>
                    `;
                }).join('');
            };

            const filterMajors = () => {
                let filtered = MOCK_MAJORS;

                if (filterGroup !== 'all') {
                    filtered = filtered.filter(m => m.group === filterGroup);
                }

                if (filterLevel !== 'all' && testResult) {
                    const suitableIds = testResult.topMajors
                        .filter(m => m.level === filterLevel)
                        .map(m => m.id);
                    filtered = filtered.filter(m => suitableIds.includes(m.id));
                } else if (filterLevel !== 'all' && !testResult) {
                    // Cannot filter by level if no test result
                }
                
                // Sort by suitability if testResult exists
                if (testResult) {
                    filtered.sort((a, b) => {
                        const matchA = testResult.topMajors.find(m => m.id === a.id)?.match || 0;
                        const matchB = testResult.topMajors.find(m => m.id === b.id)?.match || 0;
                        return matchB - matchA;
                    });
                }


                document.getElementById('major-list-grid').innerHTML = majorListHtml(filtered);
            };

            appContainer.innerHTML = `
                <section class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-4 fade-in">H·ªá Th·ªëng Ng√†nh H·ªçc</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">Kh√°m ph√° c√°c ng√†nh h·ªçc chi ti·∫øt v√† m·ª©c ƒë·ªô ph√π h·ª£p v·ªõi h·ªì s∆° c√° nh√¢n c·ªßa b·∫°n.</p>
                    
                    <!-- Filters -->
                    <div class="flex flex-wrap gap-4 mb-8 bg-white p-4 rounded-xl shadow-md fade-in" style="animation-delay: 0.4s">
                        <select id="filter-group" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="all">L·ªçc theo Nh√≥m ng√†nh</option>
                            <option value="T·ª± nhi√™n">T·ª± nhi√™n</option>
                            <option value="Kinh t·∫ø/X√£ h·ªôi">Kinh t·∫ø/X√£ h·ªôi</option>
                            <option value="X√£ h·ªôi">X√£ h·ªôi</option>
                        </select>
                        <select id="filter-level" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" ${!testResult ? 'disabled' : ''}>
                            <option value="all">L·ªçc theo M·ª©c ƒë·ªô ph√π h·ª£p</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Average">Average</option>
                            <option value="Low">Low</option>
                        </select>
                        ${!testResult ? '<span class="text-sm text-red-500 italic self-center">L√†m b√†i test ƒë·ªÉ k√≠ch ho·∫°t l·ªçc theo M·ª©c ph√π h·ª£p.</span>' : ''}
                    </div>

                    <!-- Major Grid -->
                    <div id="major-list-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Content injected here -->
                    </div>
                </section>
            `;

            document.getElementById('filter-group').onchange = (e) => { filterGroup = e.target.value; filterMajors(); };
            document.getElementById('filter-level').onchange = (e) => { filterLevel = e.target.value; filterMajors(); };
            
            filterMajors(); // Initial render
        }

        function renderMajorDetail(id) {
            const major = MOCK_MAJORS.find(m => m.id === id);
            if (!major) {
                renderAlertModal('L·ªói', 'Kh√¥ng t√¨m th·∫•y ng√†nh h·ªçc n√†y.');
                navigate('majors');
                return;
            }

            const matchData = testResult ? testResult.topMajors.find(m => m.id === id) : null;
            const matchLevel = matchData ? matchData.level : 'N/A';
            const matchPercent = matchData ? matchData.match : 'N/A';
            const levelClass = matchLevel === 'N/A' ? 'bg-gray-100 text-gray-700' : getMatchColor(matchLevel);
            
            appContainer.innerHTML = `
                <section class="max-w-5xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <button onclick="navigate('majors')" class="text-blue-600 hover:text-blue-800 mb-6 flex items-center transition fade-in">
                        <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i danh s√°ch
                    </button>
                    
                    <!-- Header -->
                    <div class="bg-white p-8 rounded-xl shadow-2xl border-t-4 border-blue-600 mb-8 fade-in">
                        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">${major.name}</h1>
                        <p class="text-xl text-blue-600 font-semibold">${major.group} | Nh√≥m RIASEC: ${major.riasec}</p>
                        
                        <div class="mt-4 flex items-center space-x-6">
                            <div>
                                <p class="text-xs font-semibold text-gray-500">M·ª©c ph√π h·ª£p c√° nh√¢n:</p>
                                <div class="flex items-center space-x-2">
                                    <p class="text-3xl font-bold ${matchPercent >= 80 ? 'text-green-600' : matchPercent >= 65 ? 'text-blue-600' : 'text-yellow-600'}">${matchPercent}%</p>
                                    <span class="text-sm font-medium px-3 py-1 rounded-full ${levelClass}">${matchLevel}</span>
                                </div>
                            </div>
                            <div class="border-l pl-6">
                                <p class="text-xs font-semibold text-gray-500">L∆∞∆°ng TB (th√°ng):</p>
                                <p class="text-lg font-bold text-gray-700">${major.salary}</p>
                            </div>
                        </div>
                    </div>

                    <!-- N·ªôi dung chi ti·∫øt -->
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="md:col-span-2 space-y-8">
                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.2s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">1. Gi·ªõi thi·ªáu Ng√†nh</h3>
                                <p class="text-gray-700 leading-relaxed">${major.desc}</p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.4s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">2. Y√™u c·∫ßu NƒÉng l·ª±c & M√¥n th·∫ø m·∫°nh</h3>
                                <ul class="list-disc list-inside space-y-2 text-gray-700">
                                    <li><span class="font-semibold">RIASEC ph√π h·ª£p:</span> ${major.riasec}</li>
                                    <li><span class="font-semibold">C√°c nƒÉng l·ª±c quan tr·ªçng:</span> ${Object.keys(major.strength).join(', ')} (C·∫ßn ƒë·∫°t m·ª©c ƒëi·ªÉm cao)</li>
                                    <li><span class="font-semibold">M√¥n th·∫ø m·∫°nh:</span> ${Object.keys(major.strength).join(', ').replace(/NƒÉng l·ª±c |M·ª•c ti√™u /g, '')}</li>
                                </ul>
                            </div>

                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.6s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">3. C√¥ng vi·ªác sau t·ªët nghi·ªáp</h3>
                                <p class="text-gray-700 leading-relaxed">${major.jobs}</p>
                            </div>
                        </div>
                        
                        <!-- Side Bar - Tr∆∞·ªùng ƒë√†o t·∫°o -->
                        <div class="md:col-span-1 space-y-6">
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 fade-in" style="animation-delay: 0.8s">
                                <h3 class="text-xl font-bold mb-4 text-gray-800">Tr∆∞·ªùng ƒë√†o t·∫°o n·ªïi b·∫≠t</h3>
                                <ul class="space-y-3">
                                    ${major.topUnis.map(uniName => {
                                        const uni = MOCK_UNIVERSITIES.find(u => u.name === uniName);
                                        return `
                                            <li class="border-b pb-2 last:border-b-0">
                                                <a href="#universities/${uni.id}" class="font-medium text-gray-700 hover:text-blue-600 transition block">
                                                    ${uniName}
                                                    <span class="text-xs text-gray-500 ml-2">(${uni.region})</span>
                                                </a>
                                            </li>
                                        `;
                                    }).join('')}
                                </ul>
                            </div>
                            
                            ${matchData ? `
                            <div class="bg-blue-50 p-6 rounded-xl shadow-lg border border-blue-300 fade-in" style="animation-delay: 1s">
                                <h3 class="text-xl font-bold text-blue-800 mb-3">So s√°nh NƒÉng l·ª±c</h3>
                                <p class="text-sm text-blue-700 mb-2">ƒêi·ªÉm m·∫°nh c·ªßa b·∫°n (Bar Chart) so v·ªõi y√™u c·∫ßu c·ªßa ng√†nh (Min Score 3/5).</p>
                                <canvas id="major-strength-bar-chart" class="max-h-60"></canvas>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </section>
            `;
            
            // Render Major Strength Comparison Chart
            if (matchData) {
                const majorStrengths = Object.keys(major.strength);
                const userScores = majorStrengths.map(s => testResult.competency[s] || 0);
                const requiredScores = majorStrengths.map(s => 3); // Assume minimum required is 3/5
                
                const ctxMajorStrength = document.getElementById('major-strength-bar-chart');
                if (ctxMajorStrength) {
                    chartInstances.majorStrength = new Chart(ctxMajorStrength, {
                        type: 'bar',
                        data: {
                            labels: majorStrengths.map(s => s.replace('NƒÉng l·ª±c ', '').replace('M·ª•c ti√™u ', '')),
                            datasets: [
                                {
                                    label: 'ƒêi·ªÉm c·ªßa b·∫°n',
                                    data: userScores,
                                    backgroundColor: '#2563eb',
                                },
                                {
                                    label: 'Y√™u c·∫ßu (Min)',
                                    data: requiredScores,
                                    backgroundColor: '#93c5fd',
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, max: 5, ticks: { stepSize: 1 } },
                            },
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                }
            }
        }
        
        // --- 5. Universities View ---
        function renderUniversityList() {
            let filterRegion = 'all';
            let filterMajor = 'all';
            let filterScore = 0;

            const universityListHtml = (universities) => {
                return universities.map(uni => {
                    const matchData = testResult ? testResult.topMajors.filter(m => m.topUnis.some(u => u.id === uni.id)) : [];
                    const avgMatch = matchData.length > 0 
                        ? Math.round(matchData.reduce((sum, m) => sum + m.match, 0) / matchData.length) 
                        : 'N/A';
                    
                    const latestScore = uni.score[2023] || 'N/A';

                    return `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:-translate-y-0.5 fade-in">
                            <img src="${uni.image}" alt="·∫¢nh tr∆∞·ªùng ${uni.name}" class="rounded-lg mb-4 w-full h-32 object-cover">
                            <h3 class="text-xl font-bold text-gray-800 mb-1">${uni.name}</h3>
                            <p class="text-sm text-blue-600 mb-3"><i class="fas fa-map-marker-alt mr-1"></i> ${uni.location} (${uni.region})</p>
                            
                            <div class="flex justify-between items-center text-sm font-medium mb-3 border-t pt-3">
                                <div><span class="text-gray-500">ƒêi·ªÉm chu·∫©n (2023):</span> <span class="text-red-500 font-bold">${latestScore}</span></div>
                                <div><span class="text-gray-500">Ph√π h·ª£p:</span> <span class="text-blue-600 font-bold">${avgMatch}%</span></div>
                            </div>
                            <p class="text-xs text-gray-600 line-clamp-2">Ng√†nh m·∫°nh: ${uni.majors.join(', ')}</p>
                            
                            <div class="mt-4">
                                <a href="#universities/${uni.id}" class="w-full block text-center bg-blue-50 text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-100 transition">Xem chi ti·∫øt</a>
                            </div>
                        </div>
                    `;
                }).join('');
            };

            const filterUniversities = () => {
                let filtered = MOCK_UNIVERSITIES;

                if (filterRegion !== 'all') {
                    filtered = filtered.filter(u => u.region === filterRegion);
                }

                if (filterMajor !== 'all') {
                    filtered = filtered.filter(u => u.majors.includes(filterMajor));
                }

                if (filterScore > 0) {
                    filtered = filtered.filter(u => (u.score[2023] || 0) <= filterScore);
                }

                document.getElementById('university-list-grid').innerHTML = universityListHtml(filtered);
            };

            appContainer.innerHTML = `
                <section class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-4 fade-in">H·ªá Th·ªëng Tr∆∞·ªùng ƒê·∫°i H·ªçc</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">T√¨m ki·∫øm tr∆∞·ªùng h·ªçc ph√π h·ª£p v·ªõi ng√†nh, khu v·ª±c v√† kh·∫£ nƒÉng ƒëi·ªÉm s·ªë c·ªßa b·∫°n.</p>
                    
                    <!-- Filters -->
                    <div class="flex flex-wrap gap-4 mb-8 bg-white p-4 rounded-xl shadow-md fade-in" style="animation-delay: 0.4s">
                        <select id="filter-region" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="all">L·ªçc theo Khu v·ª±c</option>
                            <option value="B·∫Øc">Mi·ªÅn B·∫Øc</option>
                            <option value="Trung">Mi·ªÅn Trung</option>
                            <option value="Nam">Mi·ªÅn Nam</option>
                        </select>
                        <select id="filter-major" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="all">L·ªçc theo Ng√†nh ƒë√†o t·∫°o</option>
                            ${MOCK_MAJORS.map(m => `<option value="${m.name.split('(')[0].trim()}">${m.name}</option>`).join('')}
                        </select>
                        <div class="flex items-center space-x-2 p-3 bg-gray-50 rounded-lg border border-gray-300">
                            <label for="filter-score" class="text-sm text-gray-600 whitespace-nowrap">ƒêi·ªÉm chu·∫©n T·ªëi ƒëa:</label>
                            <input type="number" id="filter-score" min="0" max="30" value="0" class="w-20 p-1 border-b text-center focus:outline-none focus:border-blue-500">
                        </div>
                    </div>

                    <!-- University Grid -->
                    <div id="university-list-grid" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Content injected here -->
                    </div>
                </section>
            `;

            document.getElementById('filter-region').onchange = (e) => { filterRegion = e.target.value; filterUniversities(); };
            document.getElementById('filter-major').onchange = (e) => { filterMajor = e.target.value.split('(')[0].trim(); filterUniversities(); };
            document.getElementById('filter-score').onchange = (e) => { filterScore = parseInt(e.target.value) || 0; filterUniversities(); };
            
            filterUniversities(); // Initial render
        }

        function renderUniversityDetail(id) {
            const uni = MOCK_UNIVERSITIES.find(u => u.id === id);
            if (!uni) {
                renderAlertModal('L·ªói', 'Kh√¥ng t√¨m th·∫•y tr∆∞·ªùng ƒë·∫°i h·ªçc n√†y.');
                navigate('universities');
                return;
            }

            const matchData = testResult ? testResult.topMajors.filter(m => m.topUnis.some(u => u.id === uni.id)) : [];
            const avgMatch = matchData.length > 0 ? Math.round(matchData.reduce((sum, m) => sum + m.match, 0) / matchData.length) : 'N/A';
            const matchColor = avgMatch !== 'N/A' && avgMatch >= 65 ? 'text-green-600' : 'text-gray-500';

            const scoreLabels = Object.keys(uni.score);
            const scoreData = Object.values(uni.score);
            
            appContainer.innerHTML = `
                <section class="max-w-5xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <button onclick="navigate('universities')" class="text-blue-600 hover:text-blue-800 mb-6 flex items-center transition fade-in">
                        <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i danh s√°ch
                    </button>

                    <!-- Header -->
                    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl border-t-4 border-blue-600 mb-8 fade-in">
                        <img src="${uni.image}" alt="Banner ${uni.name}" class="rounded-lg mb-4 w-full h-48 object-cover">
                        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">${uni.name}</h1>
                        <p class="text-xl text-blue-600 font-semibold">${uni.location} (${uni.region})</p>
                        
                        <div class="mt-4 flex flex-wrap gap-6 items-center border-t pt-4">
                            <div>
                                <p class="text-xs font-semibold text-gray-500">H·ªçc ph√≠ (TB/nƒÉm):</p>
                                <p class="text-lg font-bold text-gray-700">${uni.tuition}</p>
                            </div>
                            <div class="border-l pl-6">
                                <p class="text-xs font-semibold text-gray-500">Ng√†nh ph√π h·ª£p:</p>
                                <p class="text-lg font-bold ${matchColor}">${avgMatch}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chi ti·∫øt -->
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="md:col-span-2 space-y-8">
                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.2s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">1. Th√¥ng tin Tuy·ªÉn sinh & ƒêi·ªÉm chu·∫©n</h3>
                                <div class="mb-4">
                                    <h4 class="font-semibold text-gray-800 mb-2">ƒêi·ªÉm chu·∫©n 3 nƒÉm g·∫ßn nh·∫•t (T·ªï h·ª£p A00)</h4>
                                    <canvas id="score-line-chart" class="max-h-64"></canvas>
                                </div>
                                <p class="text-gray-700">ƒêi·ªÉm chu·∫©n cao nh·∫•t nƒÉm 2023: <span class="font-bold text-red-500">${uni.score[2023]}</span></p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.4s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">2. C√°c ng√†nh ƒë√†o t·∫°o m·∫°nh</h3>
                                <ul class="list-disc list-inside space-y-2 text-gray-700">
                                    ${uni.majors.map(m => `<li><a href="#majors" class="hover:text-blue-600 transition">${m}</a></li>`).join('')}
                                </ul>
                            </div>

                            <div class="bg-white p-6 rounded-xl shadow-lg fade-in" style="animation-delay: 0.6s">
                                <h3 class="text-2xl font-bold mb-3 text-blue-600">3. Review t·ª´ Sinh vi√™n (Mock)</h3>
                                <div class="space-y-4">
                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <p class="font-semibold text-gray-800">"Ch∆∞∆°ng tr√¨nh h·ªçc n·∫∑ng nh∆∞ng ch·∫•t l∆∞·ª£ng, c∆° s·ªü v·∫≠t ch·∫•t hi·ªán ƒë·∫°i, nhi·ªÅu c∆° h·ªôi nghi√™n c·ª©u."</p>
                                        <span class="text-sm text-gray-500">- Nguy·ªÖn VƒÉn A (CNTT, K67)</span>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <p class="font-semibold text-gray-800">"M√¥i tr∆∞·ªùng nƒÉng ƒë·ªông, nhi·ªÅu CLB, gi·∫£ng vi√™n nhi·ªát t√¨nh. Tuy nhi√™n, h·ªçc ph√≠ ƒëang tƒÉng."</p>
                                        <span class="text-sm text-gray-500">- Tr·∫ßn Th·ªã B (Kinh t·∫ø, K68)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Side Bar - C∆° h·ªôi -->
                        <div class="md:col-span-1 space-y-6">
                             <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 fade-in" style="animation-delay: 0.8s">
                                <h3 class="text-xl font-bold mb-4 text-gray-800">C∆° h·ªôi Vi·ªác l√†m</h3>
                                <p class="text-sm text-gray-700">T·ª∑ l·ªá sinh vi√™n c√≥ vi·ªác l√†m sau 1 nƒÉm t·ªët nghi·ªáp: <span class="font-bold text-green-600">95% (∆Ø·ªõc t√≠nh)</span></p>
                                <p class="text-sm text-gray-500 mt-3">Sinh vi√™n t·ªët nghi·ªáp t·ª´ tr∆∞·ªùng ƒë∆∞·ª£c c√°c t·∫≠p ƒëo√†n l·ªõn ∆∞u ti√™n tuy·ªÉn d·ª•ng.</p>
                            </div>
                        </div>
                    </div>
                </section>
            `;

            // Render Score Line Chart
            const ctxScore = document.getElementById('score-line-chart');
            if (ctxScore) {
                chartInstances.score = new Chart(ctxScore, {
                    type: 'line',
                    data: {
                        labels: scoreLabels,
                        datasets: [{
                            label: 'ƒêi·ªÉm chu·∫©n',
                            data: scoreData,
                            borderColor: '#ef4444',
                            tension: 0.3,
                            fill: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: { stepSize: 0.5 }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }
        }

        // --- 6. Blog View (Mock) ---
        function renderBlog() {
            const mockArticles = [
                { title: 'C√°ch ch·ªçn ng√†nh khi ch∆∞a bi·∫øt m√¨nh th√≠ch g√¨', summary: 'Ph√¢n t√≠ch c√°c ph∆∞∆°ng ph√°p khoa h·ªçc gi√∫p b·∫°n kh√°m ph√° b·∫£n th√¢n v√† t√¨m ra ƒëam m√™ ƒë√≠ch th·ª±c, bao g·ªìm th·ª≠ nghi·ªám Holland.', link: '#' },
                { title: 'Ng√†nh hot 2025‚Äì2030: C∆° h·ªôi v√† Th√°ch th·ª©c', summary: 'ƒê√°nh gi√° c√°c xu h∆∞·ªõng ng√†nh ngh·ªÅ t∆∞∆°ng lai nh∆∞ AI, Fintech, Logistics v√† nh·ªØng k·ªπ nƒÉng c·∫ßn thi·∫øt ƒë·ªÉ th√†nh c√¥ng.', link: '#' },
                { title: 'Top tr∆∞·ªùng ƒë√†o t·∫°o IT, Kinh t·∫ø, Y d∆∞·ª£c t·ªët nh·∫•t Vi·ªát Nam', summary: 'T·ªïng h·ª£p danh s√°ch c√°c tr∆∞·ªùng ƒë·∫°i h·ªçc h√†ng ƒë·∫ßu theo t·ª´ng kh·ªëi ng√†nh, d·ª±a tr√™n ch·∫•t l∆∞·ª£ng ƒë√†o t·∫°o v√† ƒë·∫ßu ra sinh vi√™n.', link: '#' },
                { title: 'Kinh nghi·ªám ch·ªçn tr∆∞·ªùng ph√π h·ª£p m·ª•c ti√™u t√†i ch√≠nh', summary: 'So s√°nh h·ªçc ph√≠, ch∆∞∆°ng tr√¨nh h·ªçc b·ªïng v√† m√¥i tr∆∞·ªùng h·ªçc t·∫≠p t·∫°i c√°c tr∆∞·ªùng c√¥ng l·∫≠p v√† d√¢n l·∫≠p.', link: '#' }
            ];

            appContainer.innerHTML = `
                <section class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-4 fade-in">Blog H∆∞·ªõng Nghi·ªáp</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">C·∫≠p nh·∫≠t nh·ªØng th√¥ng tin v√† l·ªùi khuy√™n h·ªØu √≠ch nh·∫•t cho m√πa tuy·ªÉn sinh.</p>
                    
                    <div class="space-y-6">
                        ${mockArticles.map((article, index) => `
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition duration-300 transform hover:translate-x-1 fade-in" style="animation-delay: ${0.4 + index * 0.2}s">
                                <h3 class="text-2xl font-bold text-blue-600 mb-2">${article.title}</h3>
                                <p class="text-gray-700 mb-4">${article.summary}</p>
                                <a href="${article.link}" class="text-sm font-semibold text-blue-500 hover:text-blue-700 transition">ƒê·ªçc ti·∫øp <i class="fas fa-arrow-right ml-1"></i></a>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }
        
        // --- 7. Contact View (Mock) ---
        function renderContact() {
            appContainer.innerHTML = `
                <section class="max-w-xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-4 fade-in">Li√™n H·ªá V·ªõi Ch√∫ng T√¥i</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">Ch√∫ng t√¥i s·∫µn s√†ng h·ªó tr·ª£ b·∫°n ƒë·ªãnh h∆∞·ªõng t∆∞∆°ng lai.</p>
                    
                    <div class="bg-white p-8 rounded-xl shadow-2xl border border-gray-100 fade-in" style="animation-delay: 0.4s">
                        <form onsubmit="event.preventDefault(); renderAlertModal('Th√†nh c√¥ng', 'C·∫£m ∆°n b·∫°n ƒë√£ g·ª≠i li√™n h·ªá! Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ.');">
                            <div class="mb-5">
                                <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">H·ªç t√™n</label>
                                <input type="text" id="contact-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="mb-5">
                                <label for="contact-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="contact-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="mb-5">
                                <label for="contact-message" class="block text-sm font-medium text-gray-700 mb-1">N·ªôi dung</label>
                                <textarea id="contact-message" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">G·ª≠i Y√™u C·∫ßu</button>
                        </form>
                    </div>
                </section>
            `;
        }

        // --- 8. User Dashboard View (Load Firestore Data) ---
        function renderUserDashboard() {
            appContainer.innerHTML = `
                <section class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                    <h2 class="text-4xl font-extrabold text-blue-600 text-center mb-4 fade-in">B·∫£ng ƒêi·ªÅu Khi·ªÉn C√° Nh√¢n</h2>
                    <p class="text-lg text-gray-600 text-center mb-10 fade-in" style="animation-delay: 0.2s">L∆∞u tr·ªØ v√† so s√°nh k·∫øt qu·∫£ test h∆∞·ªõng nghi·ªáp c·ªßa b·∫°n.</p>
                    
                    <!-- User Info / Status -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8 fade-in" style="animation-delay: 0.4s">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">T√¨nh tr·∫°ng T√†i kho·∫£n</h3>
                        <p class="text-sm text-gray-500">Tr·∫°ng th√°i: ƒê√£ ƒëƒÉng nh·∫≠p ·∫©n danh</p>
                        <p class="text-sm text-gray-500">ID Ng∆∞·ªùi d√πng: <span class="font-mono text-gray-700">${window.currentUserId || 'ƒêang t·∫£i...'}</span></p>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboard-content">
                        <div class="text-center p-12 bg-gray-100 rounded-xl">
                            <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                            <p class="text-gray-700">ƒêang t·∫£i k·∫øt qu·∫£ test g·∫ßn nh·∫•t t·ª´ Firestore...</p>
                        </div>
                    </div>

                    <!-- Comparison placeholder -->
                    <div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">So s√°nh Ng√†nh (Mock UI)</h3>
                        <p class="text-gray-600">Ch·ªçn 2-3 ng√†nh ƒë·ªÉ so s√°nh tr·ª±c quan v·ªÅ Y√™u c·∫ßu NƒÉng l·ª±c v√† M·ª©c l∆∞∆°ng.</p>
                        <button class="mt-4 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-300">T·∫°o b·∫£ng so s√°nh</button>
                    </div>
                </section>
            `;
            
            // Start listening to Firestore data
            const dashboardContent = document.getElementById('dashboard-content');
            
            if (window.isAuthReady && window.currentUserId) {
                // If the user has a test result, update the global state
                const callback = (data) => {
                    if (data) {
                        testResult = data;
                        dashboardContent.innerHTML = `<div class="fade-in"></div>`;
                        dashboardContent.querySelector('.fade-in').appendChild(
                            document.createRange().createContextualFragment(
                                `
                                <div class="bg-blue-50 p-6 rounded-xl border border-blue-300 shadow-inner mb-6">
                                    <h3 class="text-2xl font-bold text-blue-800 mb-2">K·∫øt Qu·∫£ M·ªõi Nh·∫•t</h3>
                                    <p class="text-sm text-blue-700">B·∫°n ƒë√£ ho√†n th√†nh test v√†o ${new Date(data.timestamp).toLocaleString('vi-VN')}.</p>
                                    <button onclick="navigate('result')" class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition">Xem Chi Ti·∫øt & Ph√¢n T√≠ch</button>
                                </div>
                                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">T√≥m t·∫Øt Ng√†nh ph√π h·ª£p</h3>
                                    <ul class="space-y-2">
                                        ${data.topMajors.map(m => `
                                            <li class="flex justify-between items-center border-b pb-2">
                                                <a href="#majors/${m.id}" class="text-gray-700 hover:text-blue-600">${m.name}</a>
                                                <span class="font-bold ${m.match >= 80 ? 'text-green-600' : 'text-blue-600'}">${m.match}% (${m.level})</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                                `
                            )
                        );
                        // Re-render result view if hash is still #result
                        if (window.location.hash === '#result') {
                            renderResultDashboard(data);
                        }
                    } else {
                        dashboardContent.innerHTML = `
                            <div class="text-center p-12 bg-gray-100 rounded-xl fade-in">
                                <i class="fas fa-search text-4xl text-blue-600 mb-4"></i>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Ch∆∞a c√≥ k·∫øt qu·∫£ test n√†o ƒë∆∞·ª£c l∆∞u</h3>
                                <p class="text-gray-600 mb-4">H√£y b·∫Øt ƒë·∫ßu b√†i test h∆∞·ªõng nghi·ªáp ƒë·ªÉ l∆∞u tr·ªØ k·∫øt qu·∫£ ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
                                <a href="#test" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-700 transition">L√†m B√†i Test</a>
                            </div>
                        `;
                    }
                };
                
                // Use onSnapshot to get real-time updates
                window.listenForTestResults(callback);

            } else {
                 dashboardContent.innerHTML = `
                    <div class="text-center p-12 bg-gray-100 rounded-xl">
                        <i class="fas fa-lock text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Truy c·∫≠p b·ªã h·∫°n ch·∫ø</h3>
                        <p class="text-gray-600">Vui l√≤ng ƒë·ª£i qu√° tr√¨nh x√°c th·ª±c (Auth) ho√†n t·∫•t ƒë·ªÉ truy c·∫≠p Dashboard c√° nh√¢n.</p>
                        <p class="text-xs mt-2 text-gray-500">N·∫øu th√¥ng b√°o n√†y k√©o d√†i, h√£y th·ª≠ t·∫£i l·∫°i trang.</p>
                    </div>
                `;
            }

        }

        // ====================================================================
        // INITIALIZATION AND EVENT LISTENERS
        // ====================================================================

        function mainAppInit() {
            // C·∫≠p nh·∫≠t User ID ·ªü Footer
            const footerUserIdEl = document.getElementById('footer-user-id');
            if (footerUserIdEl) {
                footerUserIdEl.textContent = `User ID: ${window.currentUserId || 'N/A'}`;
            }
            
            // X·ª≠ l√Ω Mobile Menu
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });

            // X·ª≠ l√Ω Routing
            window.addEventListener('hashchange', () => renderView(window.location.hash.replace('#', '')));
            
            // Initial render
            const initialHash = window.location.hash || '#home';
            renderView(initialHash.replace('#', ''));
        }

        // ƒê·ª£i Firebase Auth s·∫µn s√†ng tr∆∞·ªõc khi kh·ªüi t·∫°o logic ·ª©ng d·ª•ng ch√≠nh
        // Logic n√†y ƒë∆∞·ª£c g·ªçi t·ª´ script type="module" sau khi onAuthStateChanged ho√†n t·∫•t
        if (window.isAuthReady) {
            mainAppInit();
        } else {
            window.mainAppInit = mainAppInit;
        }

    </script>
    <!-- Icons Library -->
    <script src="https://kit.fontawesome.com/e5ad434b9d.js" crossorigin="anonymous"></script>
</body>
</html>